<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©¤ë²„ ì¡°í•© í‹°ì–´ ë©”ì´ì»¤ ğŸ“Š</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e6f9ff 0%, #cdf2ff 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (min-width: 1200px) {
            .main-content {
                flex-direction: row;
            }
            
            .tier-section {
                flex: 1;
            }
            
            .graph-section {
                flex: 1;
            }
        }

        h1 {
            text-align: center;
            color: #1e88e5;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        /* ë©¤ë²„ ê´€ë¦¬ ì„¹ì…˜ */
        .member-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(214, 51, 132, 0.1);
        }

        .member-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 2px solid #f8d7da;
            border-radius: 8px;
            font-size: 16px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #1e88e5;
        }

        button {
            padding: 12px 20px;
            background: #1e88e5;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        button:hover {
            background: #1565c0;
            transform: translateY(-2px);
        }

        .members-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .member-tag {
            background: #f8d7da;
            color: #721c24;
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .member-face {
            width: 30px;
            height: 30px;
            object-fit: cover;
            object-position: center 0%;
            border-radius: 50%;
            border: 2px solid #1e88e5;
        }

        .combo-faces {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .combo-face {
            width: 40px;
            height: 40px;
            object-fit: cover;
            object-position: center 10%;
            border-radius: 50%;
            border: 2px solid #1e88e5;
        }

        .combo-card-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .combo-member {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .combo-member-name {
            font-size: 10px;
            color: #666;
            font-weight: 500;
        }

        .node-face {
            width: 40px;
            height: 40px;
            object-fit: cover;
            object-position: center 10%;
            border-radius: 50%;
            border: 3px solid #d63384;
        }

        .member-tag .remove {
            cursor: pointer;
            font-weight: bold;
            color: #1e88e5;
        }

        /* í‹°ì–´ ë©”ì´ì»¤ ì„¹ì…˜ */
        .tier-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.1);
        }

        .combinations-pool {
            background: #f0faff;
            border: 2px dashed #1e88e5;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            min-height: 120px;
        }

        .combination-card {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: white;
            padding: 8px;
            margin: 5px;
            border-radius: 12px;
            border: 2px solid #bbdefb;
            cursor: grab;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(30, 136, 229, 0.1);
            min-width: 100px;
        }

        .combination-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(30, 136, 229, 0.2);
        }

        .combination-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .tier-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            min-height: 80px;
        }

        .tier-label {
            width: 140px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            border-radius: 10px;
            margin-right: 15px;
            color: #333;
        }

        .tier-s {
            background: linear-gradient(45deg, #ffb3d9, #ffc7e6);
        }

        .tier-a {
            background: linear-gradient(45deg, #fff2b3, #fff8d1);
        }

        .tier-b {
            background: linear-gradient(45deg, #b3d9ff, #d1e8ff);
        }

        .tier-c {
            background: linear-gradient(45deg, #d9d9d9, #e8e8e8);
        }

        .tier-content {
            flex: 1;
            background: rgba(255, 255, 255, 0.7);
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 15px;
            min-height: 60px;
            transition: all 0.3s;
        }

        .tier-content.drag-over {
            border-color: #1e88e5;
            background: rgba(30, 136, 229, 0.1);
        }

        /* ê·¸ë˜í”„ ì„¹ì…˜ */
        .graph-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.1);
        }

        .graph-controls {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .tier-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tier-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        #graph-container {
            width: 100%;
            height: 500px;
            border: 2px solid #bbdefb;
            border-radius: 10px;
            background: white;
        }

        .node {
            cursor: pointer;
        }

        .link {
            transition: opacity 0.3s;
        }

        .link.highlighted {
            stroke-width: 4;
            opacity: 1 !important;
        }

        .link.dimmed {
            opacity: 0.1;
        }

        .node-label {
            font-size: 14px;
            font-weight: bold;
            fill: #333;
            text-anchor: middle;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ¸ MyGO!!!!! ì¢‹ì•„í•˜ëŠ” ì¡°í•© ê·¸ë˜í”„ ğŸ“ˆ</h1>
        
        <div class="main-content">
            <!-- í‹°ì–´ ë©”ì´ì»¤ ì„¹ì…˜ -->
            <div class="tier-section">
                <div class="combinations-pool" id="combinationsPool">
                    <p style="color: #666; text-align: center;">ì¡°í•©ì„ ë“œë˜ê·¸í•´ì„œ í‹°ì–´ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
                </div>

                <!-- ìˆœì„œ ë°”ê¾¸ê¸° ì˜ì—­ -->
                <div style="background: #fff3cd; border: 2px dashed #856404; border-radius: 10px; padding: 15px; margin-bottom: 20px; text-align: center; min-height: 80px; display: flex; flex-direction: column; justify-content: center;" id="swapArea">
                    <p style="color: #856404; font-weight: bold; margin: 0;">ğŸ’« ìˆœì„œ ë°”ê¾¸ê¸°</p>
                    <p style="color: #856404; font-size: 12px; margin: 5px 0 0 0;">ì¡°í•©ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ë©´ ìˆœì„œê°€ ë°”ë€ë‹ˆë‹¤</p>
                </div>

                <div class="tier-row">
                    <div class="tier-label tier-s">ìµœì•  ì»¤í”Œ</div>
                    <div class="tier-content" data-tier="S"></div>
                </div>
                <div class="tier-row">
                    <div class="tier-label tier-a">ì¢‹ì•„í•˜ëŠ” ì»¤í”Œ</div>
                    <div class="tier-content" data-tier="A"></div>
                </div>
                <div class="tier-row">
                    <div class="tier-label tier-b">ì¢‹ì•„í•˜ëŠ” ì¡°í•©</div>
                    <div class="tier-content" data-tier="B"></div>
                </div>
                <div class="tier-row">
                            <div class="tier-label tier-c">ëª» ë³´ëŠ” ì»¤í”Œ</div>
                            <div class="tier-content" data-tier="C"></div>
                        </div>
            </div>

            <!-- ê·¸ë˜í”„ ì„¹ì…˜ -->
            <div class="graph-section">
                <div class="graph-controls">
                    <span>í‹°ì–´ í‘œì‹œ:</span>
                    <div class="tier-toggle">
                        <input type="checkbox" id="toggle-S" checked />
                        <label for="toggle-S" style="color: #ff69b4; font-weight: bold;">ìµœì•  ì»¤í”Œ</label>
                    </div>
                    <div class="tier-toggle">
                        <input type="checkbox" id="toggle-A" checked />
                        <label for="toggle-A" style="color: #ffd700; font-weight: bold;">ì¢‹ì•„í•˜ëŠ” ì»¤í”Œ</label>
                    </div>
                    <div class="tier-toggle">
                        <input type="checkbox" id="toggle-B" checked />
                        <label for="toggle-B" style="color: #4169e1; font-weight: bold;">ì¢‹ì•„í•˜ëŠ” ì¡°í•©</label>
                    </div>
                    <div class="tier-toggle">
                        <input type="checkbox" id="toggle-C" checked />
                        <label for="toggle-C" style="color: #888888; font-weight: bold;">ëª» ë³´ëŠ” ì»¤í”Œ</label>
                    </div>
                </div>
                <div id="graph-container"></div>
            </div>
        </div>
    </div>

    <script>
        let members = [];
        let combinations = [];
        let tierData = { S: [], A: [], B: [], C: [] };
        let simulation, svg, nodesGroup, linksGroup;

        // ë©¤ë²„ ì´ë¦„ì„ íŒŒì¼ëª…ìœ¼ë¡œ ë§¤í•‘
        const memberToFilename = {
            'í† ëª¨ë¦¬': 'tomori',
            'íƒ€í‚¤': 'taki', 
            'ì†Œìš”': 'soyo',
            'ì•„ë…¼': 'anon',
            'ë¼ë‚˜': 'rana'
        };

        // ë©¤ë²„ë³„ ìƒ‰ìƒ ì •ì˜
        const memberColors = {
            'í† ëª¨ë¦¬': '#77BBDD',
            'íƒ€í‚¤': '#7777AA', 
            'ì†Œìš”': '#FFDD88',
            'ì•„ë…¼': '#FF8899',
            'ë¼ë‚˜': '#77DD77'
        };

        function getMemberImage(memberName) {
            const filename = memberToFilename[memberName] || memberName.toLowerCase();
            return `asset/${filename}_face.webp`;
        }

        function getMemberColor(memberName) {
            return memberColors[memberName] || '#1e88e5';
        }

        const tierColors = {
            S: '#ff69b4',
            A: '#ffd700',
            B: '#4169e1',
            C: '#888888'
        };

        // ë©¤ë²„ ì¶”ê°€ (í•„ìš”ì‹œ)
        function addMember() {
            const input = document.getElementById('memberInput');
            if (!input) return; // ì…ë ¥ì°½ì´ ì—†ìœ¼ë©´ ë¬´ì‹œ
            const memberName = input.value.trim();

            if (memberName && !members.includes(memberName)) {
                members.push(memberName);
                input.value = '';
                generateCombinations();
            }
        }

        // ë©¤ë²„ ì‚­ì œ (í•„ìš”ì‹œ)
        function removeMember(memberName) {
            members = members.filter(m => m !== memberName);
            generateCombinations();
        }

        // ì¡°í•© ìƒì„±
        function generateCombinations() {
            combinations = [];
            for (let i = 0; i < members.length; i++) {
                for (let j = i + 1; j < members.length; j++) {
                    combinations.push([members[i], members[j]]);
                }
            }

            // ì¡°í•© ì…”í”Œ
            for (let i = combinations.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [combinations[i], combinations[j]] = [combinations[j], combinations[i]];
            }

            // ê¸°ì¡´ í‹°ì–´ ë°ì´í„° ì´ˆê¸°í™”
            tierData = { S: [], A: [], B: [], C: [] };

            updateCombinationsPool();
            updateGraph();
        }

        // ì¡°í•© í’€ ì—…ë°ì´íŠ¸
        function updateCombinationsPool() {
            const pool = document.getElementById('combinationsPool');

            if (combinations.length === 0) {
                pool.innerHTML = '<p style="color: #666; text-align: center;">ì¡°í•©ì„ ë“œë˜ê·¸í•´ì„œ í‹°ì–´ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>';
                return;
            }

            pool.innerHTML = combinations.map(combo => {
                return `<div class="combination-card" draggable="true" data-combo="${combo.join(' Ã— ')}">
                    <div class="combo-member">
                        <div class="combo-member-name">${combo[0]}</div>
                        <img src="${getMemberImage(combo[0])}" alt="${combo[0]}" class="combo-face" style="border-color: ${getMemberColor(combo[0])}" onerror="this.style.display='none'">
                    </div>
                    <div class="combo-member">
                        <div class="combo-member-name">${combo[1]}</div>
                        <img src="${getMemberImage(combo[1])}" alt="${combo[1]}" class="combo-face" style="border-color: ${getMemberColor(combo[1])}" onerror="this.style.display='none'">
                    </div>
                </div>`;
            }).join('');

            // ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì„¤ì •
            setupDragAndDrop();
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
        function setupDragAndDrop() {
            const cards = document.querySelectorAll('.combination-card');
            const tierContents = document.querySelectorAll('.tier-content');
            const swapArea = document.getElementById('swapArea');

            cards.forEach(card => {
                card.addEventListener('dragstart', e => {
                    e.dataTransfer.setData('text/plain', card.dataset.combo);
                    card.classList.add('dragging');
                });

                card.addEventListener('dragend', e => {
                    card.classList.remove('dragging');
                });
            });

            tierContents.forEach(content => {
                content.addEventListener('dragover', e => {
                    e.preventDefault();
                    content.classList.add('drag-over');
                });

                content.addEventListener('dragleave', e => {
                    content.classList.remove('drag-over');
                });

                content.addEventListener('drop', e => {
                    e.preventDefault();
                    content.classList.remove('drag-over');

                    const comboText = e.dataTransfer.getData('text/plain');
                    const tier = content.dataset.tier;

                    // ê¸°ì¡´ í‹°ì–´ì—ì„œ ì œê±°
                    Object.keys(tierData).forEach(t => {
                        tierData[t] = tierData[t].filter(combo => combo !== comboText);
                    });

                    // ìƒˆ í‹°ì–´ì— ì¶”ê°€
                    if (!tierData[tier].includes(comboText)) {
                        tierData[tier].push(comboText);
                    }

                    updateTierDisplay();
                    updateGraphElements(); // ì „ì²´ ê·¸ë˜í”„ ì¬ìƒì„± ëŒ€ì‹  ì—…ë°ì´íŠ¸ë§Œ
                });
            });

            // ìˆœì„œ ë°”ê¾¸ê¸° ì˜ì—­
            swapArea.addEventListener('dragover', e => {
                e.preventDefault();
                swapArea.style.background = '#ffeaa7';
            });

            swapArea.addEventListener('dragleave', e => {
                swapArea.style.background = '#fff3cd';
            });

            swapArea.addEventListener('drop', e => {
                e.preventDefault();
                e.stopPropagation();
                swapArea.style.background = '#fff3cd';
                
                const comboText = e.dataTransfer.getData('text/plain');
                if (!comboText) return;
                
                const [member1, member2] = comboText.split(' Ã— ');
                const swappedCombo = `${member2} Ã— ${member1}`;
                
                // í‹°ì–´ì—ì„œ ì œê±°
                Object.keys(tierData).forEach(tier => {
                    tierData[tier] = tierData[tier].filter(combo => combo !== comboText);
                });
                
                // ì¡°í•© ë°°ì—´ì—ì„œ ìˆœì„œ ë°”ê¾¸ê¸°
                const comboIndex = combinations.findIndex(combo => 
                    combo.join(' Ã— ') === comboText
                );
                if (comboIndex !== -1) {
                    combinations[comboIndex] = [member2, member1];
                }
                
                updateTierDisplay();
                updateCombinationsPool();
                updateGraphElements();
            });

            // í’€ë¡œ ë‹¤ì‹œ ë“œë˜ê·¸í•  ìˆ˜ ìˆê²Œ
            const pool = document.getElementById('combinationsPool');
            pool.addEventListener('dragover', e => e.preventDefault());
            pool.addEventListener('drop', e => {
                e.preventDefault();
                const comboText = e.dataTransfer.getData('text/plain');

                // ëª¨ë“  í‹°ì–´ì—ì„œ ì œê±°
                Object.keys(tierData).forEach(t => {
                    tierData[t] = tierData[t].filter(combo => combo !== comboText);
                });

                updateTierDisplay();
                updateGraphElements();
            });
        }

        // í‹°ì–´ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateTierDisplay() {
            Object.keys(tierData).forEach(tier => {
                const content = document.querySelector(`[data-tier="${tier}"]`);
                content.innerHTML = tierData[tier].map(combo => {
                    const [member1, member2] = combo.split(' Ã— ');
                    return `<div class="combination-card" draggable="true" data-combo="${combo}">
                        <div class="combo-member">
                            <div class="combo-member-name">${member1}</div>
                            <img src="${getMemberImage(member1)}" alt="${member1}" class="combo-face" style="border-color: ${getMemberColor(member1)}" onerror="this.style.display='none'">
                        </div>
                        <div class="combo-member">
                            <div class="combo-member-name">${member2}</div>
                            <img src="${getMemberImage(member2)}" alt="${member2}" class="combo-face" style="border-color: ${getMemberColor(member2)}" onerror="this.style.display='none'">
                        </div>
                    </div>`;
                }).join('');
            });

            // í’€ì—ì„œ ì´ë¯¸ ë°°ì¹˜ëœ ì¡°í•©ë“¤ ì œê±°
            const placedCombos = Object.values(tierData).flat();
            const pool = document.getElementById('combinationsPool');
            const remainingCombos = combinations.filter(combo => {
                const comboText = combo.join(' Ã— ');
                const reverseComboText = `${combo[1]} Ã— ${combo[0]}`;
                // ì¡°í•© ë˜ëŠ” ì—­ìˆœ ì¡°í•©ì´ í‹°ì–´ì— ë°°ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸
                return !placedCombos.some(placed => 
                    placed === comboText || placed === reverseComboText
                );
            });

            if (remainingCombos.length === 0) {
                pool.innerHTML = '<p style="color: #666; text-align: center;">ëª¨ë“  ì¡°í•©ì´ ë°°ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰</p>';
            } else {
                pool.innerHTML = remainingCombos.map(combo =>
                    `<div class="combination-card" draggable="true" data-combo="${combo.join(' Ã— ')}">
                        <div class="combo-member">
                            <div class="combo-member-name">${combo[0]}</div>
                            <img src="${getMemberImage(combo[0])}" alt="${combo[0]}" class="combo-face" style="border-color: ${getMemberColor(combo[0])}" onerror="this.style.display='none'">
                        </div>
                        <div class="combo-member">
                            <div class="combo-member-name">${combo[1]}</div>
                            <img src="${getMemberImage(combo[1])}" alt="${combo[1]}" class="combo-face" style="border-color: ${getMemberColor(combo[1])}" onerror="this.style.display='none'">
                        </div>
                    </div>`
                ).join('');
            }

            setupDragAndDrop();
        }

        // ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
        function updateGraph() {
            if (members.length === 0) return;

            const container = document.getElementById('graph-container');
            container.innerHTML = '';

            const width = container.offsetWidth;
            const height = container.offsetHeight;

            svg = d3.select('#graph-container')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            // ë…¸ë“œ ë°ì´í„° (ì›í˜•ìœ¼ë¡œ ê³ ì • ë°°ì¹˜)
            const radius = Math.min(width, height) * 0.3;
            const centerX = width / 2;
            const centerY = height / 2;
            const nodes = members.map((member, index) => {
                const angle = (index / members.length) * 2 * Math.PI;
                return {
                    id: member,
                    x: centerX + radius * Math.cos(angle),
                    y: centerY + radius * Math.sin(angle),
                    fx: centerX + radius * Math.cos(angle), // ê³ ì •
                    fy: centerY + radius * Math.sin(angle)  // ê³ ì •
                };
            });

            // ë§í¬ ë°ì´í„° (í‹°ì–´ë³„ë¡œ ìƒ‰ìƒ êµ¬ë¶„)
            const links = [];
            Object.keys(tierData).forEach(tier => {
                tierData[tier].forEach(comboText => {
                    const [source, target] = comboText.split(' Ã— ');
                    links.push({
                        source: source,
                        target: target,
                        tier: tier,
                        color: tierColors[tier]
                    });
                });
            });

            // ì‹œë®¬ë ˆì´ì…˜ ì„¤ì • (ë…¸ë“œ ê³ ì •ìœ¼ë¡œ ë‹¨ìˆœí™”)
            simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id))
                .stop(); // ì• ë‹ˆë©”ì´ì…˜ ì¤‘ì§€

            // ë§í¬ force ì‹¤í–‰í•´ì„œ source/targetì„ ê°ì²´ë¡œ ë³€í™˜
            simulation.force('link').initialize(nodes);
            simulation.force('link').links(links);

            // ë§í¬ ê·¸ë¦¬ê¸°
            linksGroup = svg.append('g');

            // ë…¸ë“œ ê·¸ë¦¬ê¸°
            nodesGroup = svg.append('g');

            updateGraphElements();
        }

        function updateGraphElements() {
            const links = [];
            Object.keys(tierData).forEach(tier => {
                const checkbox = document.getElementById(`toggle-${tier}`);
                if (checkbox && checkbox.checked) {
                    tierData[tier].forEach(comboText => {
                        const [source, target] = comboText.split(' Ã— ');
                        // ë…¸ë“œ ê°ì²´ ì§ì ‘ ì°¸ì¡°
                        const sourceNode = simulation.nodes().find(n => n.id === source);
                        const targetNode = simulation.nodes().find(n => n.id === target);
                        if (sourceNode && targetNode) {
                            links.push({
                                source: sourceNode,
                                target: targetNode,
                                tier: tier,
                                color: tierColors[tier]
                            });
                        }
                    });
                }
            });

            // ë§í¬ ì—…ë°ì´íŠ¸
            const linkSelection = linksGroup.selectAll('line')
                .data(links);

            linkSelection.exit().remove();

            linkSelection.enter()
                .append('line')
                .attr('class', 'link')
                .attr('stroke-width', 3)
                .merge(linkSelection)
                .attr('stroke', d => d.color)
                .attr('opacity', 0.7)
                .attr('x1', d => d.source.x)
                .attr('y1', d => d.source.y)
                .attr('x2', d => d.target.x)
                .attr('y2', d => d.target.y);

            // ë…¸ë“œ ì—…ë°ì´íŠ¸
            const nodeSelection = nodesGroup.selectAll('g')
                .data(simulation.nodes());

            nodeSelection.exit().remove();

            const nodeEnter = nodeSelection.enter()
                .append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.x},${d.y})`)
                .on('mouseover', handleNodeHover)
                .on('mouseout', handleNodeOut);

            // ë…¸ë“œ ì´ë¯¸ì§€ ì¶”ê°€
            nodeEnter.append('clipPath')
                .attr('id', d => `clip-${d.id}`)
                .append('circle')
                .attr('r', 30);

            nodeEnter.append('image')
                .attr('xlink:href', d => getMemberImage(d.id))
                .attr('x', -30)
                .attr('y', -30)
                .attr('width', 60)
                .attr('height', 60)
                .attr('clip-path', d => `url(#clip-${d.id})`)
                .attr('preserveAspectRatio', 'xMidYMin slice');

            // ë…¸ë“œ í…Œë‘ë¦¬ ì›
            nodeEnter.append('circle')
                .attr('r', 30)
                .attr('fill', 'none')
                .attr('stroke', d => getMemberColor(d.id))
                .attr('stroke-width', 3);
        }

        function handleNodeHover(event, d) {
            // ê´€ë ¨ëœ ëª¨ë“  ë§í¬ í•˜ì´ë¼ì´íŠ¸
            linksGroup.selectAll('line')
                .classed('highlighted', link => link.source.id === d.id || link.target.id === d.id)
                .classed('dimmed', link => link.source.id !== d.id && link.target.id !== d.id);
        }

        function handleNodeOut() {
            // í•˜ì´ë¼ì´íŠ¸ ì œê±°
            linksGroup.selectAll('line')
                .classed('highlighted', false)
                .classed('dimmed', false);
        }

        // í‹°ì–´ í† ê¸€ ì´ë²¤íŠ¸
        document.querySelectorAll('[id^="toggle-"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateGraphElements);
        });

        // ì—”í„°í‚¤ë¡œ ë©¤ë²„ ì¶”ê°€ (ì—†ëŠ” ìš”ì†Œì´ë¯€ë¡œ ì œê±°)
        // document.getElementById('memberInput').addEventListener('keypress', e => {
        //     if (e.key === 'Enter') {
        //         addMember();
        //     }
        // });

        // ì´ˆê¸° ë©¤ë²„ ì„¤ì • (MyGO!!!!! ë©¤ë²„ë“¤)
        members = ['í† ëª¨ë¦¬', 'íƒ€í‚¤', 'ì†Œìš”', 'ì•„ë…¼', 'ë¼ë‚˜'];
        generateCombinations();
    </script>
</body>

</html>
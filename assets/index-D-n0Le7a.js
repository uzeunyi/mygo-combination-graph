(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const e of c.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&s(e)}).observe(document,{childList:!0,subtree:!0});function n(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(a){if(a.ep)return;a.ep=!0;const c=n(a);fetch(a.href,c)}})();const w={토모리:"tomori",타키:"taki",소요:"soyo",아논:"anon",라나:"rana"},B={토모리:"#77BBDD",타키:"#7777AA",소요:"#FFDD88",아논:"#FF8899",라나:"#77DD77"},T={S:"#ff69b4",A:"#ffd700",B:"#4169e1",C:"#888888"};function v(t){return`asset/${w[t]||t.toLowerCase()}_face.webp`}function h(t){return B[t]||"#1e88e5"}function I(t){const r=[];for(let n=0;n<t.length;n++)for(let s=n+1;s<t.length;s++)r.push([t[n],t[s]]);for(let n=r.length-1;n>0;n--){const s=Math.floor(Math.random()*(n+1));[r[n],r[s]]=[r[s],r[n]]}return r}function j(t,r){const n=document.getElementById("combinationsPool");if(t.length===0){n.innerHTML='<p style="color: #666; text-align: center;">조합을 드래그해서 티어를 만들어보세요!</p>';return}n.innerHTML=t.map(s=>`<div class="combination-card" draggable="true" data-combo="${s.join(" × ")}">
            <div class="combo-member">
                <div class="combo-member-name">${s[0]}</div>
                <img src="${v(s[0])}" alt="${s[0]}" class="combo-face" style="border-color: ${h(s[0])}" onerror="this.style.display='none'">
            </div>
            <div class="combo-member">
                <div class="combo-member-name">${s[1]}</div>
                <img src="${v(s[1])}" alt="${s[1]}" class="combo-face" style="border-color: ${h(s[1])}" onerror="this.style.display='none'">
            </div>
        </div>`).join(""),r()}function M(t,r,n){Object.keys(t).forEach(e=>{const l=document.querySelector(`[data-tier="${e}"]`);l.innerHTML=t[e].map(f=>{const[o,i]=f.split(" × ");return`<div class="combination-card" draggable="true" data-combo="${f}">
                <div class="combo-member">
                    <div class="combo-member-name">${o}</div>
                    <img src="${v(o)}" alt="${o}" class="combo-face" style="border-color: ${h(o)}" onerror="this.style.display='none'">
                </div>
                <div class="combo-member">
                    <div class="combo-member-name">${i}</div>
                    <img src="${v(i)}" alt="${i}" class="combo-face" style="border-color: ${h(i)}" onerror="this.style.display='none'">
                </div>
            </div>`}).join("")});const s=Object.values(t).flat(),a=document.getElementById("combinationsPool"),c=r.filter(e=>{const l=e.join(" × "),f=`${e[1]} × ${e[0]}`;return!s.some(o=>o===l||o===f)});c.length===0?a.innerHTML='<p style="color: #666; text-align: center;">모든 조합이 배치되었습니다! 🎉</p>':a.innerHTML=c.map(e=>`<div class="combination-card" draggable="true" data-combo="${e.join(" × ")}">
                <div class="combo-member">
                    <div class="combo-member-name">${e[0]}</div>
                    <img src="${v(e[0])}" alt="${e[0]}" class="combo-face" style="border-color: ${h(e[0])}" onerror="this.style.display='none'">
                </div>
                <div class="combo-member">
                    <div class="combo-member-name">${e[1]}</div>
                    <img src="${v(e[1])}" alt="${e[1]}" class="combo-face" style="border-color: ${h(e[1])}" onerror="this.style.display='none'">
                </div>
            </div>`).join(""),n()}function L(t,r,n,s,a){const c=document.querySelectorAll(".combination-card"),e=document.querySelectorAll(".tier-content"),l=document.getElementById("swapArea");c.forEach(o=>{o.addEventListener("dragstart",i=>{i.dataTransfer.setData("text/plain",o.dataset.combo),o.classList.add("dragging")}),o.addEventListener("dragend",i=>{o.classList.remove("dragging")})}),e.forEach(o=>{o.addEventListener("dragover",i=>{i.preventDefault(),o.classList.add("drag-over")}),o.addEventListener("dragleave",i=>{o.classList.remove("drag-over")}),o.addEventListener("drop",i=>{i.preventDefault(),o.classList.remove("drag-over");const m=i.dataTransfer.getData("text/plain"),d=o.dataset.tier;Object.keys(t).forEach(u=>{t[u]=t[u].filter(b=>b!==m)}),t[d].includes(m)||t[d].push(m),n(),a()})}),l.addEventListener("dragover",o=>{o.preventDefault(),l.style.background="#ffeaa7"}),l.addEventListener("dragleave",o=>{l.style.background="#fff3cd"}),l.addEventListener("drop",o=>{o.preventDefault(),o.stopPropagation(),l.style.background="#fff3cd";const i=o.dataTransfer.getData("text/plain");if(!i)return;const[m,d]=i.split(" × ");Object.keys(t).forEach(b=>{t[b]=t[b].filter(S=>S!==i)});const u=r.findIndex(b=>b.join(" × ")===i);u!==-1&&(r[u]=[d,m]),n(),a()});const f=document.getElementById("combinationsPool");f.addEventListener("dragover",o=>o.preventDefault()),f.addEventListener("drop",o=>{o.preventDefault();const i=o.dataTransfer.getData("text/plain");Object.keys(t).forEach(m=>{t[m]=t[m].filter(d=>d!==i)}),n(),a()})}let y,C,O,x;function H(t,r){if(t.length===0)return;const n=document.getElementById("graph-container");n.innerHTML="";const s=n.offsetWidth,a=n.offsetHeight;C=d3.select("#graph-container").append("svg").attr("width",s).attr("height",a);const c=Math.min(s,a)*.3,e=s/2,l=a/2,f=t.map((i,m)=>{const d=m/t.length*2*Math.PI;return{id:i,x:e+c*Math.cos(d),y:l+c*Math.sin(d),fx:e+c*Math.cos(d),fy:l+c*Math.sin(d)}}),o=[];Object.keys(r).forEach(i=>{r[i].forEach(m=>{const[d,u]=m.split(" × ");o.push({source:d,target:u,tier:i,color:T[i]})})}),y=d3.forceSimulation(f).force("link",d3.forceLink(o).id(i=>i.id)).stop(),y.force("link").initialize(f),y.force("link").links(o),x=C.append("g"),O=C.append("g"),P(r)}function P(t){const r=[];document.querySelectorAll(".tier-chip.active").forEach(e=>{const l=e.dataset.tier;t[l].forEach(f=>{const[o,i]=f.split(" × "),m=y.nodes().find(u=>u.id===o),d=y.nodes().find(u=>u.id===i);m&&d&&r.push({source:m,target:d,tier:l,color:T[l]})})});const s=x.selectAll("line").data(r);s.exit().remove(),s.enter().append("line").attr("class","link").attr("stroke-width",3).merge(s).attr("stroke",e=>e.color).attr("opacity",.7).attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y);const a=O.selectAll("g").data(y.nodes());a.exit().remove();const c=a.enter().append("g").attr("class","node").attr("transform",e=>`translate(${e.x},${e.y})`).on("mouseover",q).on("mouseout",D);c.append("clipPath").attr("id",e=>`clip-${e.id}`).append("circle").attr("r",30),c.append("image").attr("xlink:href",e=>v(e.id)).attr("x",-30).attr("y",-30).attr("width",60).attr("height",60).attr("clip-path",e=>`url(#clip-${e.id})`).attr("preserveAspectRatio","xMidYMin slice"),c.append("circle").attr("r",30).attr("fill","none").attr("stroke",e=>h(e.id)).attr("stroke-width",3)}function q(t,r){x.selectAll("line").classed("highlighted",n=>n.source.id===r.id||n.target.id===r.id).classed("dimmed",n=>n.source.id!==r.id&&n.target.id!==r.id)}function D(){x.selectAll("line").classed("highlighted",!1).classed("dimmed",!1)}let A=[],p=[],g={S:[],A:[],B:[],C:[]};function F(){p=I(A),g={S:[],A:[],B:[],C:[]},j(p,()=>L(g,p,()=>M(g,p,()=>L(g,p,()=>M(g,p,()=>L(g,p,k,E,$)),E,$)),E,$)),H(A,g)}function k(){M(g,p,()=>L(g,p,k,E,$))}function E(){j(p,()=>L(g,p,k,E,$))}function $(){P(g)}document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".tier-chip");t.forEach(r=>{r.addEventListener("click",()=>{document.querySelectorAll(".tier-chip.active").length===t.length?(t.forEach(s=>s.classList.remove("active")),r.classList.add("active")):r.classList.toggle("active"),$()})}),A=["토모리","타키","소요","아논","라나"],F()});
